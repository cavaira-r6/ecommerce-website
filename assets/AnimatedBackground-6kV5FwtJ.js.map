{"version":3,"file":"AnimatedBackground-6kV5FwtJ.js","sources":["../../src/components/common/AnimatedBackground.tsx"],"sourcesContent":["import { Canvas } from \"@react-three/fiber\";\r\nimport { Float, useGLTF, Environment } from \"@react-three/drei\";\r\nimport { Suspense, useMemo } from \"react\";\r\nimport type { GLTF } from \"three-stdlib\";\r\nimport * as THREE from \"three\";\r\n\r\ntype FloatingModel = {\r\n  url: string;\r\n  position: [number, number, number];\r\n  scale: number;\r\n  speed: number;\r\n  rotationIntensity: number;\r\n  floatIntensity: number;\r\n};\r\n\r\nconst MODEL_FILES = [\"models/8.glb\", \"models/80.glb\", \"models/9.glb\", \"models/3.glb\", \"models/5.glb\", \"models/26.glb\", \"models/33.glb\", \"models/13.glb\"];\r\nconst MODEL_URLS = MODEL_FILES.map(f => `https://cavaira-r6.github.io/ecommerce-website/${f}`);\r\n// number of model instances to spawn (reduced to keep scene lighter)\r\nconst INSTANCE_COUNT = 24;\r\n\r\n// We'll validate model URLs at runtime (skip 404s/HTML responses) to avoid loader errors\r\nconst logged = new Set<string>();\r\n\r\n// Stateful list of valid model URLs (only these will be preloaded/used)\r\nimport { useState, useEffect } from 'react';\r\n\r\nconst validateModelUrls = async (urls: string[]) => {\r\n  const valid: string[] = [];\r\n  await Promise.all(urls.map(async (u) => {\r\n    try {\r\n      const res = await fetch(u, { method: 'GET' });\r\n      if (!res.ok) {\r\n        console.warn(`Model not found or server error for ${u} (status ${res.status})`);\r\n        return;\r\n      }\r\n      const ct = res.headers.get('content-type') || '';\r\n      // Skip HTML/text responses (404 pages) or JSON\r\n      if (ct.includes('text/html') || ct.includes('application/json') || ct.includes('text/plain')) {\r\n        console.warn(`Skipping ${u} because content-type is ${ct}`);\r\n        return;\r\n      }\r\n      valid.push(u);\r\n    } catch (err) {\r\n      console.warn(`Error fetching ${u}:`, err);\r\n    }\r\n  }));\r\n  return valid;\r\n};\r\n\r\n// Hook: validate on module load inside component via state\r\n\r\nfunction GLTFModel({ url, scale = 1 }: { url: string; scale?: number }) {\r\n  const gltf = useGLTF(url) as unknown as GLTF;\r\n  const cloned = useMemo(() => (gltf?.scene ? (gltf.scene.clone(true) as THREE.Group) : new THREE.Group()), [gltf]);\r\n\r\n  // center\r\n  useMemo(() => {\r\n    try {\r\n      const box = new THREE.Box3().setFromObject(cloned);\r\n      const center = new THREE.Vector3();\r\n      box.getCenter(center);\r\n      cloned.position.sub(center);\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n  }, [cloned]);\r\n\r\n  // material tweaks\r\n  useMemo(() => {\r\n    cloned.traverse((child) => {\r\n      // @ts-ignore\r\n      if ((child as any).isMesh) {\r\n        const mesh = child as THREE.Mesh;\r\n        if (Array.isArray(mesh.material)) {\r\n          mesh.material.forEach((m: any) => {\r\n            if (!m) return;\r\n            m.side = THREE.DoubleSide;\r\n            if (m.roughness !== undefined) m.roughness = Math.max(0, m.roughness - 0.2);\r\n            if (m.emissiveIntensity !== undefined) m.emissiveIntensity = (m.emissiveIntensity || 0) + 0.2;\r\n            m.needsUpdate = true;\r\n          });\r\n        } else if (mesh.material) {\r\n          const m: any = mesh.material;\r\n          m.side = THREE.DoubleSide;\r\n          if (m.roughness !== undefined) m.roughness = Math.max(0, m.roughness - 0.2);\r\n          if (m.emissiveIntensity !== undefined) m.emissiveIntensity = (m.emissiveIntensity || 0) + 0.2;\r\n          m.needsUpdate = true;\r\n        }\r\n  mesh.castShadow = true;\r\n  mesh.receiveShadow = true;\r\n      }\r\n    });\r\n  }, [cloned]);\r\n\r\n  if (process.env.NODE_ENV === \"development\" && !logged.has(url)) {\r\n    // eslint-disable-next-line no-console\r\n    console.info(`GLTF loaded: ${url}`);\r\n    logged.add(url);\r\n  }\r\n\r\n  return <primitive object={cloned} scale={scale} />;\r\n}\r\n\r\nfunction Scene({ floatingModels }: { floatingModels: FloatingModel[] }) {\r\n  return (\r\n    <>\r\n      <ambientLight intensity={0.5} />\r\n      <hemisphereLight intensity={0.6} />\r\n      <directionalLight position={[5, 10, 7]} intensity={1} />\r\n      <pointLight position={[-10, -10, -10]} intensity={0.6} />\r\n\r\n      {floatingModels.map((m, i) => (\r\n        <Float key={i} speed={m.speed} rotationIntensity={m.rotationIntensity} floatIntensity={m.floatIntensity}>\r\n          <group position={m.position}>\r\n            <GLTFModel url={m.url} scale={m.scale} />\r\n          </group>\r\n        </Float>\r\n      ))}\r\n\r\n      <Environment preset=\"sunset\" background={false} />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default function AnimatedBackground() {\r\n  const [validModelUrls, setValidModelUrls] = useState<string[] | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n  const valid = await validateModelUrls(MODEL_URLS);\r\n  if (mounted) setValidModelUrls(valid);\r\n\r\n      // Preload via useGLTF if available\r\n      try {\r\n        // @ts-ignore\r\n        if ((useGLTF as any) && typeof (useGLTF as any).preload === 'function') {\r\n          (valid.length ? valid : MODEL_URLS).forEach((u: string) => (useGLTF as any).preload(u));\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n  // nothing else to do here â€” we've validated model URLs and preloaded them\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  const floatingModels = useMemo((): FloatingModel[] => {\r\n    const out: FloatingModel[] = [];\r\n  const urls = (validModelUrls && validModelUrls.length) ? validModelUrls : [];\r\n  // If no valid urls, bail out early to avoid errors\r\n  if (!urls.length) return out;\r\n  const count = INSTANCE_COUNT;\r\n  for (let i = 0; i < count; i++) {\r\n      const url = urls[i % urls.length];\r\n      // wider spread: increase horizontal range and vertical variation\r\n      const spread = 40; // horizontal spread multiplier (was ~20)\r\n      const vertical = 8; // vertical variation (was ~6)\r\n      out.push({\r\n        url,\r\n        position: [\r\n          (Math.random() - 0.5) * spread,\r\n          Math.random() * vertical - 2, // slightly lower baseline and taller range\r\n          (Math.random() - 0.5) * spread,\r\n        ],\r\n  // reduce maximum size: range ~0.6 - 1.4 (was 0.8 - 2.3)\r\n  scale: 0.6 + Math.random() * 0.8,\r\n        // faster speeds and wider oscillation for more visible motion\r\n        speed: 0.4 + Math.random() * 1.0, // was 0.2-0.8\r\n        rotationIntensity: 0.4 + Math.random() * 1.6, // was 0.2-1.4\r\n        floatIntensity: 0.8 + Math.random() * 1.7, // was 0.4-1.4\r\n      });\r\n    }\r\n    return out;\r\n  }, [validModelUrls]);\r\n\r\n  return (\r\n    <Canvas camera={{ position: [0, 2, 15], fov: 50 }} dpr={[1, 2]} gl={{ antialias: true, alpha: false }} style={{ position: \"fixed\", inset: 0, width: \"100%\", height: \"100%\", pointerEvents: \"none\", zIndex: -10 }}>\r\n      <color attach=\"background\" args={[\"#000000\"]} />\r\n      <fog attach=\"fog\" args={[\"#000000\", 10, 30]} />\r\n\r\n      <Suspense fallback={null}>\r\n        <Scene floatingModels={floatingModels} />\r\n      </Suspense>\r\n    </Canvas>\r\n  );\r\n}\r\n"],"names":["MODEL_FILES","MODEL_URLS","f","INSTANCE_COUNT","validateModelUrls","urls","valid","u","res","ct","err","GLTFModel","url","scale","gltf","useGLTF","cloned","useMemo","THREE.Group","box","THREE.Box3","center","THREE.Vector3","child","mesh","m","THREE.DoubleSide","Scene","floatingModels","jsxs","Fragment","jsx","i","Float","Environment","AnimatedBackground","validModelUrls","setValidModelUrls","useState","useEffect","mounted","out","count","spread","Canvas","Suspense"],"mappings":"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"}